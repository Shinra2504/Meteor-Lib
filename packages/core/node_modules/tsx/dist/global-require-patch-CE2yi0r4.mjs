import c from"node:module";import S from"node:fs";import{parseTsconfig as v,getTsconfig as E,createFilesMatcher as O,createPathsMatcher as j}from"get-tsconfig";import{p as M,t as b,a as g}from"./index-DiuW-CAd.mjs";import{s as u,i as _,f as P,a as A,r as R}from"./file-url-tbtyRuyi.mjs";import{p as T}from"./client-Cg7nS93t.mjs";import m from"node:path";import{fileURLToPath as N}from"node:url";const I=s=>{if(s.includes("import")||s.includes("export"))try{return M(s)[3]}catch{return!0}return!1},C=/\.[cm]?tsx?$/,i=process.env.TSX_TSCONFIG_PATH?{path:m.resolve(process.env.TSX_TSCONFIG_PATH),config:v(process.env.TSX_TSCONFIG_PATH)}:E(),D=[".cts",".mts",".ts",".tsx",".jsx"],G=[".js",".cjs",".mjs"],H=i&&O(i),l=Object.assign(Object.create(null),c._extensions),U=l[".js"],h=(s,e)=>{T?.send&&T.send({type:"dependency",path:e});const n=D.some(t=>e.endsWith(t)),r=G.some(t=>e.endsWith(t));if(!n&&!r)return U(s,e);let o=S.readFileSync(e,"utf8");if(e.endsWith(".cjs")){const t=b(e,o);t&&(o=u()?_(t):t.code)}else if(n||I(o)){const t=g(o,e,{tsconfigRaw:H?.(e)});o=u()?_(t):t.code}s._compile(o,e)};[".js",".ts",".tsx",".jsx"].forEach(s=>{l[s]=h}),Object.defineProperty(l,".mjs",{value:h,enumerable:!1});const W=`${m.sep}node_modules${m.sep}`,x=i&&j(i),p=c._resolveFilename.bind(c),y=(s,e,n,r)=>{const o=R(s);if(e?.filename&&(C.test(e.filename)||i?.config.compilerOptions?.allowJs)&&o)for(const t of o)try{return p(t,e,n,r)}catch(f){const{code:a}=f;if(a!=="MODULE_NOT_FOUND"&&a!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw f}},F=(s,e,n,r)=>{const o=s.indexOf("?");if(o!==-1&&(s=s.slice(0,o)),s.startsWith(P)&&(s=N(s)),x&&!A(s)&&!e?.filename?.includes(W)){const f=x(s);for(const a of f){const d=y(a,e,n,r);if(d)return d;try{return p(a,e,n,r)}catch{}}}const t=y(s,e,n,r);return t||p(s,e,n,r)},X=()=>{const{sourceMapsEnabled:s}=process,{_extensions:e,_resolveFilename:n}=c;return process.setSourceMapsEnabled(!0),c._extensions=l,c._resolveFilename=F,()=>{s===!1&&process.setSourceMapsEnabled(!1),c._extensions=e,c._resolveFilename=n}};export{F as a,X as r};
