"use strict";var c=require("node:module"),F=require("node:fs"),u=require("get-tsconfig"),m=require("./index-DTCJysGI.cjs"),i=require("./file-url-BcwMOquI.cjs"),T=require("./client-DjommMgI.cjs"),p=require("node:path"),M=require("node:url");const g=e=>{if(e.includes("import")||e.includes("export"))try{return m.parseEsm(e)[3]}catch{return!0}return!1},E=/\.[cm]?tsx?$/,l=process.env.TSX_TSCONFIG_PATH?{path:p.resolve(process.env.TSX_TSCONFIG_PATH),config:u.parseTsconfig(process.env.TSX_TSCONFIG_PATH)}:u.getTsconfig(),O=[".cts",".mts",".ts",".tsx",".jsx"],j=[".js",".cjs",".mjs"],b=l&&u.createFilesMatcher(l),d=Object.assign(Object.create(null),c._extensions),P=d[".js"],h=(e,s)=>{T.parent?.send&&T.parent.send({type:"dependency",path:s});const t=O.some(r=>s.endsWith(r)),o=j.some(r=>s.endsWith(r));if(!t&&!o)return P(e,s);let n=F.readFileSync(s,"utf8");if(s.endsWith(".cjs")){const r=m.transformDynamicImport(s,n);r&&(n=i.shouldApplySourceMap()?i.inlineSourceMap(r):r.code)}else if(t||g(n)){const r=m.transformSync(n,s,{tsconfigRaw:b?.(s)});n=i.shouldApplySourceMap()?i.inlineSourceMap(r):r.code}e._compile(n,s)};[".js",".ts",".tsx",".jsx"].forEach(e=>{d[e]=h}),Object.defineProperty(d,".mjs",{value:h,enumerable:!1});const A=`${p.sep}node_modules${p.sep}`,x=l&&u.createPathsMatcher(l),v=c._resolveFilename.bind(c),S=(e,s,t,o)=>{const n=i.resolveTsPath(e);if(s?.filename&&(E.test(s.filename)||l?.config.compilerOptions?.allowJs)&&n)for(const r of n)try{return v(r,s,t,o)}catch(f){const{code:a}=f;if(a!=="MODULE_NOT_FOUND"&&a!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw f}},y=(e,s,t,o)=>{const n=e.indexOf("?");if(n!==-1&&(e=e.slice(0,n)),e.startsWith(i.fileUrlPrefix)&&(e=M.fileURLToPath(e)),x&&!i.isRelativePath(e)&&!s?.filename?.includes(A)){const f=x(e);for(const a of f){const _=S(a,s,t,o);if(_)return _;try{return v(a,s,t,o)}catch{}}}const r=S(e,s,t,o);return r||v(e,s,t,o)},R=()=>{const{sourceMapsEnabled:e}=process,{_extensions:s,_resolveFilename:t}=c;return process.setSourceMapsEnabled(!0),c._extensions=d,c._resolveFilename=y,()=>{e===!1&&process.setSourceMapsEnabled(!1),c._extensions=s,c._resolveFilename=t}};exports.register=R,exports.resolveFilename=y;
